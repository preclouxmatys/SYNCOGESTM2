title: "Python–R–Git Project (IEAP) — Posture effects on movement dynamics"
author: "Matys Précloux"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output:
  html_document:
    toc: true
    toc_depth: 2
    number_sections: true
    df_print: paged
    self_contained: true
output_file: "precloux.matys.html"

**GitHub repository (public):**  
[https://github.com/preclouxmatys/SYNCOGESTM2](https://github.com/preclouxmatys/SYNCOGESTM2)

# 1 Research question

Human movement analysis relies on both validated tools and reproducible pipelines.  
The goal of this project is to test whether **postural configuration** influences global movement dynamics during dyadic interaction.

**Research question:**  
Does posture (**SEATED**, **SEMI-STANDING**, **STANDING**) affect the indice of movement by participants?

**Hypothesis:**  
Standing posture induces higher indice movement quantity.

# 2 Data

## 2.1 Source
Data are Vicon "Trajectories" CSV exports containing 3D marker coordinates (X/Y/Z, in mm) sampled over time.

## 2.2 Variables of interest
Movement is summarized using **Quantity of Motion (QdM)** computed for:
- **Wrists** (left + right)
- **Head** (left + right temples)

For each dyad file, both participants are available (P1 and P2).

# 3 Python processing pipeline

This section summarizes the Python code organization and the processing steps.

## 3.1 Project organization (reproducibility)
The repository follows a reproducible structure:
- `src/` contains reusable functions (CSV parsing, marker extraction, QdM computation).
- `notebooks/` contains step-by-step processing notebooks.
- `results/<MODE>/` stores outputs (test or raw mode).

Two execution modes are used:
- `MODE="test"`: small dataset tracked on GitHub to ensure reproducibility
- `MODE="raw"`: full dataset (not committed)

## 3.2 Vicon CSV parsing
Vicon CSV exports include multi-line headers (marker names, axes, units).  
A dedicated parser reconstructs flattened columns (e.g., `marker_X`, `marker_Y`, `marker_Z`) so that the rest of the pipeline is independent of header format.

## 3.3 Quantity of Motion (QdM)
For one 3D marker, QdM is computed as the cumulative frame-to-frame displacement:

\[
QdM = \sum_{t=2}^{T} \sqrt{(\Delta x_t)^2 + (\Delta y_t)^2 + (\Delta z_t)^2}
\]

Wrists index:  
\[
QdM_{wrists} = QdM_{right\_wrist} + QdM_{left\_wrist}
\]

Head index (temples):  
\[
QdM_{head} = QdM_{right\_temple} + QdM_{left\_temple}
\]

## 3.4 Shoulder-width normalization
To obtain a unitless measure robust to inter-individual scale differences, QdM is normalized by median shoulder width:

\[
QdM_{norm} = \frac{QdM_{mm}}{shoulder\ width_{median\ mm}}
\]

This produces:
- `P1_QDM_WRISTS_norm`, `P2_QDM_WRISTS_norm`
- `P1_QDM_HEAD_norm`, `P2_QDM_HEAD_norm`

The final file used for statistics is:  
`results/<MODE>/vicon_QDM_wrists_head_normByShoulders.xlsx`

# 4 R statistical analysis (to show results, and plot)

## 4.1 Results

### 4.1.1 Descriptive statistics

#### 4.1.1.1 WRIST

| Posture   | N  | Mean   | SD     |
|-----------|----|--------|--------|
| SEATED    | 24 | 78.690 | 61.268 |
| SEMI      | 24 | 74.935 | 49.897 |
| STANDING  | 24 | 134.694| 79.868 |

#### 4.1.1.2 Repeated-measures ANOVA (Greenhouse–Geisser)

| Effect  | df1, df2      | F     | p      | η²p  |
|---------|---------------|-------|--------|------|
| posture | 1.58, 36.40   | 33.41 | < .001 | .592 |

#### 4.1.1.3 Post-hoc comparisons (Bonferroni)

| Contrast            | Estimate | t      | p_adj  |
|--------------------|----------|--------|--------|
| SEATED – SEMI      | 3.76     | 0.63   | 1.000  |
| SEATED – STANDING  | -56.00   | -6.67  | < .0001|
| SEMI – STANDING    | -59.76   | -6.13  | < .0001|

#### 4.2.1.1 HEAD

| Posture   | N  | Mean  | SD     |
|-----------|----|-------|--------|
| SEATED    | 24 | 56.656| 22.387 |
| SEMI      | 24 | 52.455| 19.839 |
| STANDING  | 24 | 61.054| 23.806 |

#### 4.2.1.2 Repeated-measures ANOVA (Greenhouse–Geisser)

| Effect  | df1, df2      | F    | p     | η²p  |
|---------|---------------|------|-------|------|
| posture | 1.79, 41.28   | 5.69 | .008  | .198 |

#### 4.2.1.3 Post-hoc comparisons (Bonferroni)

| Contrast            | Estimate | t      | p_adj |
|--------------------|----------|--------|-------|
| SEATED – SEMI      | 4.2      | 1.53   | .418  |
| SEATED – STANDING  | -4.4     | -2.12  | .135  |
| SEMI – STANDING    | -8.6     | -3.11  | .015  |

# 4.2 R Code to have  boxplot

```{r}
library(readxl)
library(dplyr)
library(tidyr)
library(stringr)
library(ggplot2)
library(here)

MODE <- "raw"
in_path <- here("results", MODE, "vicon_QDM_wrists_head_normByShoulders.xlsx")
df <- read_excel(in_path)

df <- df %>%
  mutate(
    posture = case_when(
      str_detect(video_id, "^SEATED") ~ "SEATED",
      str_detect(video_id, "^SEMI") ~ "SEMI",
      str_detect(video_id, "^STANDING") ~ "STANDING"
    ),
    dyad = str_extract(video_id, "D\\d+"),
    posture = factor(posture, levels = c("SEATED","SEMI","STANDING"))
  )
```
```{r}
ymax_wrist <- max(df_wrist_long$value, na.rm = TRUE)
```

```{r}
df_wrist_long <- df %>%
  select(dyad, posture, P1_QDM_WRISTS_norm, P2_QDM_WRISTS_norm) %>%
  pivot_longer(cols = c(P1_QDM_WRISTS_norm, P2_QDM_WRISTS_norm),
               names_to = "participant", values_to = "value") %>%
  mutate(value = as.numeric(value))

ggplot(df_wrist_long, aes(x = posture, y = value)) +
  geom_boxplot(outlier.alpha = 0.3) +
  theme_minimal(base_size = 13) +
  labs(title = "Normalized movement (WRIST)",
       x = "Posture",
       y = "QdM / shoulder width (a.u.)") 
```

```{r}
df_head_long <- df %>%
  select(dyad, posture, P1_QDM_HEAD_norm, P2_QDM_HEAD_norm) %>%
  pivot_longer(cols = c(P1_QDM_HEAD_norm, P2_QDM_HEAD_norm),
               names_to = "participant", values_to = "value") %>%
  mutate(value = as.numeric(value))

ggplot(df_head_long, aes(x = posture, y = value)) +
  geom_boxplot(outlier.alpha = 0.3) +
  theme_minimal(base_size = 13) +
  labs(title = "Normalized movement (HEAD)",
       x = "Posture",
       y = "QdM / shoulder width (a.u.)")
```

